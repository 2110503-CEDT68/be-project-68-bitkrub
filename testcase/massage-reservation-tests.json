{
  "info": {
    "_postman_id": "massage-reservation-test-003",
    "name": "Massage Reservation System - Test Suite",
    "description": "Complete test suite for Massage Reservation System - Run with Postman or Newman. Required: Create admin user first manually.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "PREREQ: Admin Login (Must Run First)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Admin login success', function () {",
              "    pm.response.to.have.status(200);",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.eql(true);",
              "    pm.expect(jsonData.token).to.exist;",
              "    pm.environment.set('admin_token', jsonData.token);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "body": {
          "mode": "raw",
          "raw": "{\"email\": \"admin@test.com\", \"password\": \"admin123\"}"
        },
        "url": {"raw": "{{base_url}}/api/v1/auth/login", "host": ["{{base_url}}"], "path": ["api", "v1", "auth", "login"]}
      }
    },
    {
      "name": "PREREQ: Create Shop",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Shop created', function () {",
              "    pm.response.to.have.status(201);",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.eql(true);",
              "    pm.expect(jsonData.data._id).to.exist;",
              "    pm.environment.set('shop_id', jsonData.data._id);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"},
          {"key": "Authorization", "value": "Bearer {{admin_token}}"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"name\": \"Test Spa {{$timestamp}}\", \"address\": \"123 Test Street\", \"location\": \"Bangkok\", \"tel\": \"021234567\", \"map\": \"https://maps.google.com/test\", \"openTime\": \"09:00\", \"closeTime\": \"21:00\", \"priceRangeMin\": 500, \"priceRangeMax\": 3000}"
        },
        "url": {"raw": "{{base_url}}/api/v1/shops", "host": ["{{base_url}}"], "path": ["api", "v1", "shops"]}
      }
    },
    {
      "name": "PREREQ: Create Service",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Service created', function () {",
              "    pm.response.to.have.status(201);",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.eql(true);",
              "    pm.expect(jsonData.data._id).to.exist;",
              "    pm.environment.set('service_id', jsonData.data._id);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"},
          {"key": "Authorization", "value": "Bearer {{admin_token}}"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"name\": \"Thai Massage\", \"area\": \"full body\", \"duration\": 60, \"oil\": \"herbal\", \"price\": 1200}"
        },
        "url": {"raw": "{{base_url}}/api/v1/shops/{{shop_id}}/services", "host": ["{{base_url}}"], "path": ["api", "v1", "shops", "{{shop_id}}", "services"]}
      }
    },
    {
      "name": "1. User Registration",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Response has success true', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.eql(true);",
              "});",
              "",
              "pm.test('Response has token', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.token).to.exist;",
              "    pm.environment.set('user_token', jsonData.token);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "body": {
          "mode": "raw",
          "raw": "{\"name\": \"Test User\", \"email\": \"user{{$timestamp}}@test.com\", \"telephone\": \"0812345678\", \"password\": \"password123\"}"
        },
        "url": {"raw": "{{base_url}}/api/v1/auth/register", "host": ["{{base_url}}"], "path": ["api", "v1", "auth", "register"]}
      }
    },
    {
      "name": "2. Validation Check - Missing Telephone",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 400', function () {",
              "    pm.response.to.have.status(400);",
              "});",
              "",
              "pm.test('Response has success false', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.eql(false);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "body": {
          "mode": "raw",
          "raw": "{\"name\": \"Invalid User\", \"email\": \"invalid@test.com\", \"password\": \"password123\"}"
        },
        "url": {"raw": "{{base_url}}/api/v1/auth/register", "host": ["{{base_url}}"], "path": ["api", "v1", "auth", "register"]}
      }
    },
    {
      "name": "3. User View Shops (Public)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Response has shops data', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.eql(true);",
              "    pm.expect(jsonData.data).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {"raw": "{{base_url}}/api/v1/shops", "host": ["{{base_url}}"], "path": ["api", "v1", "shops"]}
      }
    },
    {
      "name": "4. User View Services (Public)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Response has services data', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.eql(true);",
              "    pm.expect(jsonData.data).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {"raw": "{{base_url}}/api/v1/services", "host": ["{{base_url}}"], "path": ["api", "v1", "services"]}
      }
    },
    {
      "name": "5. Create First Booking",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 201', function () {",
              "    pm.response.to.have.status(201);",
              "});",
              "",
              "pm.test('Response has reservation data', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.eql(true);",
              "    pm.expect(jsonData.data._id).to.exist;",
              "    pm.environment.set('reservation_id_1', jsonData.data._id);",
              "});",
              "",
              "pm.test('Shows reservation count message', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.message).to.contain('1 of 3');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"},
          {"key": "Authorization", "value": "Bearer {{user_token}}"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"resvDate\": \"2026-12-31T10:00:00.000Z\", \"shop\": \"{{shop_id}}\", \"service\": \"{{service_id}}\"}"
        },
        "url": {"raw": "{{base_url}}/api/v1/reservations", "host": ["{{base_url}}"], "path": ["api", "v1", "reservations"]}
      }
    },
    {
      "name": "6. Create Second Booking",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 201', function () {",
              "    pm.response.to.have.status(201);",
              "});",
              "",
              "pm.test('Shows 2 of 3', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.message).to.contain('2 of 3');",
              "    pm.environment.set('reservation_id_2', jsonData.data._id);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"},
          {"key": "Authorization", "value": "Bearer {{user_token}}"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"resvDate\": \"2026-12-30T14:00:00.000Z\", \"shop\": \"{{shop_id}}\", \"service\": \"{{service_id}}\"}"
        },
        "url": {"raw": "{{base_url}}/api/v1/reservations", "host": ["{{base_url}}"], "path": ["api", "v1", "reservations"]}
      }
    },
    {
      "name": "7. Create Third Booking",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 201', function () {",
              "    pm.response.to.have.status(201);",
              "});",
              "",
              "pm.test('Shows 3 of 3', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.message).to.contain('3 of 3');",
              "    pm.environment.set('reservation_id_3', jsonData.data._id);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"},
          {"key": "Authorization", "value": "Bearer {{user_token}}"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"resvDate\": \"2026-12-29T16:00:00.000Z\", \"shop\": \"{{shop_id}}\", \"service\": \"{{service_id}}\"}"
        },
        "url": {"raw": "{{base_url}}/api/v1/reservations", "host": ["{{base_url}}"], "path": ["api", "v1", "reservations"]}
      }
    },
    {
      "name": "8. Check Max 3 Bookings Condition",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 400', function () {",
              "    pm.response.to.have.status(400);",
              "});",
              "",
              "pm.test('Shows max reservation error', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.eql(false);",
              "    pm.expect(jsonData.message).to.contain('3 active reservations');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {"key": "Content-Type", "value": "application/json"},
          {"key": "Authorization", "value": "Bearer {{user_token}}"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"resvDate\": \"2026-12-28T10:00:00.000Z\", \"shop\": \"{{shop_id}}\", \"service\": \"{{service_id}}\"}"
        },
        "url": {"raw": "{{base_url}}/api/v1/reservations", "host": ["{{base_url}}"], "path": ["api", "v1", "reservations"]}
      }
    },
    {
      "name": "9. User View Own Bookings",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Shows 3 reservations', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.eql(true);",
              "    pm.expect(jsonData.count).to.eql(3);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [{"key": "Authorization", "value": "Bearer {{user_token}}"}],
        "url": {"raw": "{{base_url}}/api/v1/reservations", "host": ["{{base_url}}"], "path": ["api", "v1", "reservations"]}
      }
    },
    {
      "name": "10. User Edit Own Booking",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Reservation updated', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.eql(true);",
              "    pm.expect(jsonData.data.resvDate).to.exist;",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [
          {"key": "Content-Type", "value": "application/json"},
          {"key": "Authorization", "value": "Bearer {{user_token}}"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"resvDate\": \"2027-01-15T12:00:00.000Z\"}"
        },
        "url": {"raw": "{{base_url}}/api/v1/reservations/{{reservation_id_1}}", "host": ["{{base_url}}"], "path": ["api", "v1", "reservations", "{{reservation_id_1}}"]}
      }
    },
    {
      "name": "11. User Delete Own Booking",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Reservation deleted', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.eql(true);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [{"key": "Authorization", "value": "Bearer {{user_token}}"}],
        "url": {"raw": "{{base_url}}/api/v1/reservations/{{reservation_id_1}}", "host": ["{{base_url}}"], "path": ["api", "v1", "reservations", "{{reservation_id_1}}"]}
      }
    },
    {
      "name": "12. User Logout",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Logout success', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.eql(true);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [{"key": "Authorization", "value": "Bearer {{user_token}}"}],
        "url": {"raw": "{{base_url}}/api/v1/auth/logout", "host": ["{{base_url}}"], "path": ["api", "v1", "auth", "logout"]}
      }
    },
    {
      "name": "13. Admin View Any Booking",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Admin sees all reservations', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.eql(true);",
              "    pm.expect(jsonData.data).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [{"key": "Authorization", "value": "Bearer {{admin_token}}"}],
        "url": {"raw": "{{base_url}}/api/v1/reservations", "host": ["{{base_url}}"], "path": ["api", "v1", "reservations"]}
      }
    },
    {
      "name": "14. Admin Edit Any Booking",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Admin updated reservation', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.eql(true);",
              "    pm.expect(jsonData.data.status).to.eql('confirmed');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [
          {"key": "Content-Type", "value": "application/json"},
          {"key": "Authorization", "value": "Bearer {{admin_token}}"}
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"status\": \"confirmed\", \"resvDate\": \"2027-02-01T10:00:00.000Z\"}"
        },
        "url": {"raw": "{{base_url}}/api/v1/reservations/{{reservation_id_2}}", "host": ["{{base_url}}"], "path": ["api", "v1", "reservations", "{{reservation_id_2}}"]}
      }
    },
    {
      "name": "15. Admin Delete Any Booking",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Admin deleted reservation', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.eql(true);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [{"key": "Authorization", "value": "Bearer {{admin_token}}"}],
        "url": {"raw": "{{base_url}}/api/v1/reservations/{{reservation_id_3}}", "host": ["{{base_url}}"], "path": ["api", "v1", "reservations", "{{reservation_id_3}}"]}
      }
    }
  ],
  "variable": [
    {"key": "base_url", "value": "http://localhost:5000"},
    {"key": "admin_token", "value": ""},
    {"key": "user_token", "value": ""},
    {"key": "shop_id", "value": ""},
    {"key": "service_id", "value": ""},
    {"key": "reservation_id_1", "value": ""},
    {"key": "reservation_id_2", "value": ""},
    {"key": "reservation_id_3", "value": ""}
  ]
}